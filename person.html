<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Persons</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/alpinejs@2.8.2/dist/alpine.js"
      defer
    ></script>
  </head>
  <body class="bg-gray-100">
    <div x-data="app()" x-init="persons = []">
      <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-4">Add Persons</h1>

        <!-- Person Form -->
        <div class="bg-white shadow p-4 mb-4">
          <h2 class="text-lg font-bold mb-2">Add a Person</h2>
          <form x-on:submit.prevent="addPerson" class="grid grid-cols-2 gap-4">
            <div>
              <label for="firstName" class="block font-bold">First Name</label>
              <input
                x-model="person.firstName"
                id="firstName"
                type="text"
                required
                class="border border-gray-300 p-2 rounded w-full"
              />
              <span x-text="errors.firstName" class="text-red-500"></span>
            </div>
            <div>
              <label for="lastName" class="block font-bold">Last Name</label>
              <input
                x-model="person.lastName"
                id="lastName"
                type="text"
                required
                class="border border-gray-300 p-2 rounded w-full"
              />
              <span x-text="errors.lastName" class="text-red-500"></span>
            </div>
            <div>
              <label for="dob" class="block font-bold">Date of Birth</label>
              <input
                x-model="person.dob"
                id="dob"
                type="date"
                required
                class="border border-gray-300 p-2 rounded w-full"
              />
              <span x-text="errors.dob" class="text-red-500"></span>
            </div>
            <div>
              <label for="email" class="block font-bold">Email</label>
              <input
                x-model="person.email"
                id="email"
                type="email"
                required
                class="border border-gray-300 p-2 rounded w-full"
              />
              <span x-text="errors.email" class="text-red-500"></span>
            </div>
            <div>
              <label for="phoneNumber" class="block font-bold"
                >Phone Number</label
              >
              <input
                x-model="person.phoneNumber"
                id="phoneNumber"
                type="tel"
                required
                class="border border-gray-300 p-2 rounded w-full"
              />
              <span x-text="errors.phoneNumber" class="text-red-500"></span>
            </div>
            <div>
              <label for="city" class="block font-bold">City</label>
              <input
                x-model="person.city"
                id="city"
                type="text"
                required
                class="border border-gray-300 p-2 rounded w-full"
              />
              <span x-text="errors.city" class="text-red-500"></span>
            </div>
            <div>
              <label for="pincode" class="block font-bold"
                >Pincode/Zipcode</label
              >
              <input
                x-model="person.pincode"
                id="pincode"
                type="text"
                required
                class="border border-gray-300 p-2 rounded w-full"
              />
              <span x-text="errors.pincode" class="text-red-500"></span>
            </div>
            <div class="col-span-2">
              <button
                type="submit"
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
              >
                Add Person
              </button>
            </div>
          </form>
        </div>

        <!-- Persons List -->
        <div class="bg-white shadow p-4">
          <h2 class="text-lg font-bold mb-2">Persons List</h2>
          <div class="mb-4">
            <input
              x-model="searchQuery"
              type="text"
              placeholder="Search"
              class="border border-gray-300 p-2 rounded w-full"
            />
          </div>
          <table class="w-full">
            <thead>
              <tr>
                <th class="py-2 px-4 bg-gray-200 text-left">First Name</th>
                <th class="py-2 px-4 bg-gray-200 text-left">Last Name</th>
                <th class="py-2 px-4 bg-gray-200 text-left">Date of Birth</th>
                <th class="py-2 px-4 bg-gray-200 text-left">Email</th>
                <th class="py-2 px-4 bg-gray-200 text-left">Phone Number</th>
                <th class="py-2 px-4 bg-gray-200 text-left">City</th>
                <th class="py-2 px-4 bg-gray-200 text-left">Pincode/Zipcode</th>
              </tr>
            </thead>
            <tbody>
              <template
                x-for="(person, index) in paginatedPersons"
                :key="person.email"
              >
                <tr>
                  <td class="py-2 px-4">
                    <strong x-text="person.firstName"></strong>
                  </td>
                  <td class="py-2 px-4">
                    <strong x-text="person.lastName"></strong>
                  </td>
                  <td class="py-2 px-4">
                    <strong x-text="person.dob"></strong>
                  </td>
                  <td class="py-2 px-4">
                    <strong x-text="person.email"></strong>
                  </td>
                  <td class="py-2 px-4">
                    <strong x-text="person.phoneNumber"></strong>
                  </td>
                  <td class="py-2 px-4">
                    <strong x-text="person.city"></strong>
                  </td>
                  <td class="py-2 px-4">
                    <strong x-text="person.pincode"></strong>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
          <div class="mt-4">
            <button
              x-on:click="sortTable"
              class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
            >
              Sort
            </button>
            <span class="ml-2"
              >Total Persons: <strong x-text="filteredPersons.length"></strong
            ></span>
            <div class="mt-4">
              <button
                x-on:click="changePage('prev')"
                :disabled="currentPage === 1"
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
              >
                Previous
              </button>
              <button
                x-on:click="changePage('next')"
                :disabled="currentPage === totalPages"
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
              >
                Next
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      function app() {
        return {
          person: {
            firstName: "",
            lastName: "",
            dob: "",
            email: "",
            phoneNumber: "",
            city: "",
            pincode: "",
          },

          errors: {},
          persons: [],
          searchQuery: "",
          sortAsc: true,
          pageSize: 5,
          currentPage: 1,

          addPerson() {
            this.validateForm();
            if (Object.keys(this.errors).length === 0) {
              this.persons.push({ ...this.person });
              // console.log(this.person.email);
              this.person = {
                firstName: "",
                lastName: "",
                dob: "",
                email: "",
                phoneNumber: "",
                city: "",
                pincode: "",
              };
            }
          },

          validateForm() {
            this.errors = {};

            if (!this.person.firstName) {
              this.errors.firstName = "First Name is required.";
            }
            if (!this.person.lastName) {
              this.errors.lastName = "Last Name is required.";
            }
            if (!this.person.dob) {
              this.errors.dob = "Date of Birth is required.";
            } else {
              const today = new Date();
              const dob = new Date(this.person.dob);
              const age = today.getFullYear() - dob.getFullYear();

              if (age < 18) {
                this.errors.dob = "Age must be at least 18 years.";
              }
            }
            if (!this.person.email) {
              this.errors.email = "Email is required.";
            } else if (!this.validateEmail(this.person.email)) {
              this.errors.email = "Invalid email format.";
            }
            if (!this.person.phoneNumber) {
              this.errors.phoneNumber = "Phone Number is required.";
            } else if (!this.validatePhoneNumber(this.person.phoneNumber)) {
              this.errors.phoneNumber = "Invalid phone number format.";
            }
            if (!this.person.city) {
              this.errors.city = "City is required.";
            }
            if (!this.person.pincode) {
              this.errors.pincode = "Pincode/Zipcode is required.";
            } else if (!this.validatePincode(this.person.pincode)) {
              this.errors.pincode = "Invalid pincode/zipcode format.";
            }
          },

          validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
          },

          validatePhoneNumber(phoneNumber) {
            const phoneRegex = /^[0-9]{10,}$/;
            return phoneRegex.test(phoneNumber);
          },

          validatePincode(pincode) {
            const pincodeRegex = /^[0-9]{5,}$/;
            return pincodeRegex.test(pincode);
          },

          sortTable() {
            this.sortAsc = !this.sortAsc;
            if (this.sortAsc) {
              this.persons.sort((a, b) =>
                a.firstName.localeCompare(b.firstName)
              );
            } else {
              this.persons.sort((a, b) =>
                b.firstName.localeCompare(a.firstName)
              );
            }
          },

          get filteredPersons() {
            const query = this.searchQuery.toLowerCase();
            return this.persons.filter(
              (person) =>
                person.firstName.toLowerCase().includes(query) ||
                person.lastName.toLowerCase().includes(query) ||
                person.email.toLowerCase().includes(query) ||
                person.city.toLowerCase().includes(query)
            );
          },

          get paginatedPersons() {
            const startIndex = (this.currentPage - 1) * this.pageSize;
            const endIndex = startIndex + this.pageSize;
            this.totalPages = Math.ceil(
              this.filteredPersons.length / this.pageSize
            );
            return this.filteredPersons.slice(startIndex, endIndex);
          },

          changePage(direction) {
            if (direction === "prev" && this.currentPage > 1) {
              this.currentPage--;
            } else if (
              direction === "next" &&
              this.currentPage < this.totalPages
            ) {
              this.currentPage++;
            }
          },
        };
      }
    </script>
  </body>
</html>
